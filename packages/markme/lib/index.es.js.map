{"version":3,"file":"index.es.js","sources":["../helper/dom.js","../helper/selection.js","../plugins/highlight/style.js","../plugins/highlight/index.js","../plugins/badge/index.js","../index.js"],"sourcesContent":["/**\n * @file selection\n * @author Cuttle Cong\n * @date 2018/4/30\n * @description\n */\n\nexport function isText(node) {\n  return node && node.nodeType === document.TEXT_NODE\n}\n\nfunction createElem(tagName, document = document) {\n  return document.createElement(tagName)\n}\nconst doms = new Map()\nexport function getSingleDOM(tagName = 'div', id = Math.random(), document = document) {\n  if (doms.has(id)) {\n    return doms.get(id)\n  }\n  let ele = createElem(tagName, document)\n  doms.set(id, ele)\n  return ele\n}\n\n\nexport function getPageOffset(el) {\n  el = el.getBoundingClientRect()\n  return {\n    width: el.width,\n    height: el.height,\n    left: el.left + window.scrollX,\n    top: el.top + window.scrollY\n  }\n}\n\nexport function getTextNodeSize(node, window = window) {\n  if (!(node instanceof window.Range)) {\n    const range = window.document.createRange()\n    range.selectNodeContents(node)\n    node = range\n  }\n  return getPageOffset(node)\n}\n\nfunction _hasRelaMaker(attr) {\n  return function(node, parent) {\n    let parentNode = node\n    while (parentNode !== parent) {\n      if (!parentNode) {\n        return false\n      }\n      parentNode = parentNode[attr]\n    }\n\n    return true\n  }\n}\nexport const hasParent = _hasRelaMaker('parentNode')\nexport const hasNext = _hasRelaMaker('nextSibling')\nexport const hasPrev = _hasRelaMaker('previousSibling')\n\nfunction walkDOM(node, func) {\n  let rlt = func(node) // this will invoke the functionToInvoke from arg\n  // skip\n  if (rlt === false) {\n    return\n  }\n  node = node.firstChild\n  while (node) {\n    walkDOM(node, func)\n    node = node.nextSibling\n  }\n}\n\nexport const walk = walkDOM\n\nexport function getSelector(el, root = document) {\n  if (!el || el.nodeType !== Node.ELEMENT_NODE) {\n    throw new Error('getSelector requires element.')\n  }\n  if (root === el) {\n    return null\n  }\n  if (el.hasAttribute('id')) {\n    return `#${el.getAttribute('id')}`\n  }\n\n  const children = Array.from(el.parentNode ? el.parentNode.children : [])\n  let index = -1,\n    hasBrother = false\n  children.forEach((x, i) => {\n    if (x === el) {\n      index = i + 1\n    } else if (el.tagName === x.tagName) {\n      hasBrother = true\n    }\n  })\n\n  let selector = el.localName\n  if (index > 0 && hasBrother) {\n    selector = `${el.localName}:nth-child(${index})`\n  }\n  let ps = getSelector(el.parentNode, root)\n  return ps !== null ? `${ps} > ${selector}` : selector\n}\n","/**\n * @file selection\n * @author Cuttle Cong\n * @date 2018/4/30\n * @description\n */\nimport {\n  isText,\n  getTextNodeSize,\n  hasParent,\n  hasPrev,\n  walk,\n  hasNext,\n  getSelector\n} from './dom'\n\nfunction makeReset(fn) {\n  let wrap = function() {\n    if (wrap.__called) {\n      return\n    }\n    wrap.__called = true\n\n    // range.setStart(cloneRange.startContainer, cloneRange.startOffset)\n    // range.setEnd(cloneRange.endContainer, cloneRange.endOffset)\n    fn()\n  }\n  return wrap\n}\n\nexport function sliceNode(node, { offset, length } = {}, window = window) {\n  const document = window.document\n\n  if (node && node.nodeType === Node.ELEMENT_NODE) {\n    let sumOffset = 0,\n      relativeOffset = offset\n    for (let i = 0; i < node.childNodes.length; i++) {\n      let child = node.childNodes[i]\n      if (child && 'textContent' in child) {\n        sumOffset += child.textContent.length\n        relativeOffset = relativeOffset - child.textContent.length\n      }\n\n      if (sumOffset > offset) {\n        return sliceNode(\n          child,\n          {\n            offset: relativeOffset + child.textContent.length,\n            length\n          },\n          window\n        )\n      }\n    }\n  }\n\n  if (node && 'textContent' in node) {\n    const text = node.textContent\n    const pNode = node.parentNode\n    if (!pNode) {\n      return {}\n    }\n\n    if (text.length < offset && node.nextSibling) {\n      return sliceNode(\n        node.nextSibling,\n        { offset: offset - text.length, length },\n        window\n      )\n    }\n    const nodes = [\n      text.slice(offset + length),\n      text.slice(offset, offset + length),\n      text.slice(0, offset)\n    ].map(text => document.createTextNode(text))\n    // .filter(text => text.trim() !== '')\n\n    let head = nodes[0]\n    pNode.replaceChild(nodes[0], node)\n    let resetNodes = nodes.slice(1)\n\n    let reset = makeReset(function() {\n      pNode.replaceChild(node, nodes[0])\n      resetNodes.forEach(function(node) {\n        node.remove()\n      })\n    })\n\n    resetNodes.forEach(function(node) {\n      pNode.insertBefore(node, head)\n      head = node\n    })\n\n    return { reset, nodes }\n  }\n  return {}\n}\n\nexport function getLastRangePos(window) {\n  let selection = window.getSelection()\n  let document = window.document\n\n  let range = selection.getRangeAt(selection.rangeCount - 1)\n  let reset\n  let pos\n\n  if (range) {\n    // eslint-disable-next-line no-inner-declarations\n\n    const startContainer = range.startContainer\n    const endContainer = range.endContainer\n    const startParentContainer = startContainer.parentElement\n    const endParentContainer = endContainer.parentElement\n    const commonAncestorContainer = range.commonAncestorContainer\n    // pure text nodes\n\n    const startWholeText = range.startContainer.textContent\n    const startOffset = range.startOffset\n    const endWholeText = range.endContainer.textContent\n    const endOffset = range.endOffset\n\n    //  \" hello world \"\n    //      _____\n    if (startContainer === endContainer) {\n      let data = sliceNode(\n        startContainer,\n        {\n          offset: startOffset,\n          length: endOffset - startOffset\n        },\n        window\n      )\n      let nodes = data.nodes\n      range.selectNodeContents(nodes[1])\n      pos = getTextNodeSize(range, window)\n      reset = data.reset\n    } else {\n      //  \" hello<code>x</code>world \"\n      //      ^^^^^^^^^^^^^^^^^^^\n      if (isText(startContainer)) {\n        const nodes = [\n          startWholeText.slice(startOffset),\n          startWholeText.slice(0, startOffset)\n        ].map(x => document.createTextNode(x))\n        let head = nodes[0]\n        startParentContainer.replaceChild(nodes[0], startContainer)\n        let resetNodes = nodes.slice(1)\n\n        reset = makeReset(function() {\n          startParentContainer.replaceChild(startContainer, nodes[0])\n          resetNodes.forEach(function(node) {\n            node.remove()\n          })\n        })\n\n        resetNodes.forEach(function(node) {\n          startParentContainer.insertBefore(node, head)\n          head = node\n        })\n        range.setStart(nodes[0], 0)\n      }\n\n      if (isText(endContainer)) {\n        const nodes = [\n          endWholeText.slice(endOffset),\n          endWholeText.slice(0, endOffset)\n        ].map(x => document.createTextNode(x))\n        let head = nodes[0]\n        endParentContainer.replaceChild(nodes[0], endContainer)\n        let resetNodes = nodes.slice(1)\n\n        reset = (reset =>\n          makeReset(function() {\n            reset && reset()\n            endParentContainer.replaceChild(endContainer, nodes[0])\n            resetNodes.forEach(function(node) {\n              node.remove()\n            })\n          }))(reset)\n\n        resetNodes.forEach(function(node) {\n          endParentContainer.insertBefore(node, head)\n          head = node\n        })\n        range.setEnd(nodes[1], nodes[1].textContent.length)\n      }\n\n      pos = getTextNodeSize(range, window)\n    }\n\n    return {\n      reset,\n      pos\n    }\n  }\n\n  return {}\n}\n\nexport function removeRanges(window = window) {\n  const selection = window.getSelection()\n  selection.removeAllRanges()\n}\n\nexport function getSelectionContainsList(cond) {\n  return function(selection = window.getSelection()) {\n    if (selection.isCollapsed) {\n      return []\n    }\n    let list = []\n    let range = selection.getRangeAt(selection.rangeCount - 1)\n\n    function getTexts(root, range) {\n      let list = []\n      walk(root, function(node) {\n        if (cond(node)) {\n          if (range.isPointInRange(node, 0)) {\n            list.push(node)\n          }\n        }\n      })\n      return list\n    }\n    if (cond(range.commonAncestorContainer)) {\n      return [range.commonAncestorContainer]\n    }\n    if (range) {\n      list = getTexts(range.commonAncestorContainer, range)\n    }\n    return list\n  }\n}\n\nconst getTextList = getSelectionContainsList(node => {\n  if (isText(node)) {\n    if (node.parentNode) {\n      if (\n        node.parentNode.tagName &&\n        ['style', 'script', 'noscript', 'title'].includes(\n          node.parentNode.tagName.toLowerCase()\n        )\n      ) {\n        return false\n      }\n    }\n    return true\n  }\n  return false\n})\nexport const getSelectionTextList = getTextList\n\nfunction isEmpty(node) {\n  return node.textContent.trim() === ''\n}\n\nexport function getSelectionTextSeqList(selection) {\n  const textList = getTextList(selection)\n  if (!textList || !textList.length) {\n    return textList\n  }\n  // debugger\n  let newList = [textList.shift()]\n  while (textList.length) {\n    let head = newList[newList.length - 1]\n    let node = textList.shift()\n    if (node.previousSibling === head) {\n      head.textContent = head.textContent + node.textContent\n      node.remove()\n    } else {\n      newList.push(node)\n    }\n  }\n\n  return newList.filter(x => !isEmpty(x))\n}\n","export default `\n.mark-highlight-popover {\n  position: absolute;\n  z-index: 9999;\n  background-color: #fff;\n  box-shadow: 0 0 10px 3px #ccc;\n  transform: translate(-54%, 20%);\n  min-width: 40px;\n  max-width: 90vw;\n  padding: 4px 7px;\n  box-sizing: content-box;\n  text-align: center;\n  user-select: none;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n}\n.mark-highlight-popover > textarea {\n  display: block;\n  resize: none;\n}\n.mark-highlight-popover::before {\n  content: \"\";\n  border-left: 5px solid transparent;\n  border-right: 5px solid transparent;\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid #fff;\n  display: block;\n  position: absolute;\n  top: -10px;\n  left: 50%;\n}\n.mark-highlight-color {\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  margin: auto 2px;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\n.mark-highlight-active-color {\n  background-size: contain;\n  background-image: url(\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTI1MTM3NDcxNDM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwNDYiIGRhdGEtc3BtLWFuY2hvci1pZD0iYTMxM3guNzc4MTA2OS4wLmkwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTE3Ni42NjE2MDEgODE3LjE3Mjg4MUMxNjguNDcyNzk4IDgyNS42NDQwNTUgMTY4LjcwMTcwNiA4MzkuMTQ5NjM2IDE3Ny4xNzI4ODEgODQ3LjMzODQzOCAxODUuNjQ0MDU2IDg1NS41MjcyNDEgMTk5LjE0OTYzNiA4NTUuMjk4MzMyIDIwNy4zMzg0MzggODQ2LjgyNzE1N0w4MjYuMDA1MTA1IDIwNi44MjcxNTdDODM0LjE5MzkwNyAxOTguMzU1OTgzIDgzMy45NjQ5OTggMTg0Ljg1MDQwMyA4MjUuNDkzODI0IDE3Ni42NjE2MDEgODE3LjAyMjY1IDE2OC40NzI3OTggODAzLjUxNzA2OSAxNjguNzAxNzA2IDc5NS4zMjgyNjcgMTc3LjE3Mjg4MUwxNzYuNjYxNjAxIDgxNy4xNzI4ODFaIiBwLWlkPSIyMDQ3Ij48L3BhdGg+PHBhdGggZD0iTTc5NS4zMjgyNjcgODQ2LjgyNzE1N0M4MDMuNTE3MDY5IDg1NS4yOTgzMzIgODE3LjAyMjY1IDg1NS41MjcyNDEgODI1LjQ5MzgyNCA4NDcuMzM4NDM4IDgzMy45NjQ5OTggODM5LjE0OTYzNiA4MzQuMTkzOTA3IDgyNS42NDQwNTUgODI2LjAwNTEwNSA4MTcuMTcyODgxTDIwNy4zMzg0MzggMTc3LjE3Mjg4MUMxOTkuMTQ5NjM2IDE2OC43MDE3MDYgMTg1LjY0NDA1NiAxNjguNDcyNzk4IDE3Ny4xNzI4ODEgMTc2LjY2MTYwMSAxNjguNzAxNzA2IDE4NC44NTA0MDMgMTY4LjQ3Mjc5OCAxOTguMzU1OTgzIDE3Ni42NjE2MDEgMjA2LjgyNzE1N0w3OTUuMzI4MjY3IDg0Ni44MjcxNTdaIiBwLWlkPSIyMDQ4Ij48L3BhdGg+PC9zdmc+\");\n}\n.mark-highlight-color:hover {\n  opacity: .68;\n}\n.mark-highlight-color.disabled {\n  cursor: not-allowed;\n  opacity: .5;\n}\n.mark-highlight-item {\n  cursor: pointer;\n}\n`\n","/**\n * @file highlight\n * @author Cuttle Cong\n * @date 2018/4/30\n * @description\n */\nimport debounce from 'lodash.debounce'\nimport * as domUtil from '../../helper/dom'\nimport _rgbHex from 'rgb-hex'\nimport md5 from 'md5'\nimport * as selectionUtil from '../../helper/selection'\nimport styleText from './style'\n\nfunction rgbHex(str) {\n  try {\n    return `#${_rgbHex(str)}`\n  } catch (e) {\n    return str\n  }\n}\n\nfunction replaceToMark(textNode, { color, words, uid } = {}, opt) {\n  // eslint-disable-next-line no-use-before-define\n  if (isItemNode(textNode)) {\n    return\n  }\n  let mark = opt.window.document.createElement('mark')\n  mark.className = 'mark-highlight-item'\n  mark.style.backgroundColor = color\n  mark.setAttribute('data-mark-id', uid)\n  words && mark.setAttribute('data-mark-words', words)\n  textNode.parentNode && textNode.parentNode.replaceChild(mark, textNode)\n  mark.appendChild(textNode)\n}\n\nclass MapQueue {\n  constructor() {\n    this.mapQueue = {}\n  }\n  get(id) {\n    return this.mapQueue[id]\n  }\n  add(id, val) {\n    let list = this.get(id)\n    if (list) {\n      list.push(val)\n    } else {\n      this.mapQueue[id] = [val]\n    }\n  }\n  get keys() {\n    return Object.keys(this.mapQueue)\n  }\n  clear(id) {\n    this.reset(id, false)\n  }\n  reset(id, exec = true) {\n    if (typeof id === 'undefined') {\n      this.keys.map(key => this.reset(key, exec))\n    } else {\n      let list = this.get(id)\n      if (list) {\n        exec && list.forEach(reset => reset())\n        list.splice(0, list.length)\n      }\n    }\n  }\n}\nconst resetQueue = new MapQueue()\n\nfunction prependTextNodeChunks(textNode) {\n  if (!domUtil.isText(textNode)) {\n    return\n  }\n  let prev = textNode.previousSibling\n  while (domUtil.isText(prev)) {\n    textNode.textContent = prev.textContent + textNode.textContent\n    let tmpPrev = prev.previousSibling\n    prev.remove()\n    prev = tmpPrev\n  }\n}\n\nfunction appendTextNodeChunks(textNode) {\n  if (!domUtil.isText(textNode)) {\n    return\n  }\n  let next = textNode.nextSibling\n  while (domUtil.isText(next)) {\n    textNode.textContent = textNode.textContent + next.textContent\n    let tmpNext = next.nextSibling\n    next.remove()\n    next = tmpNext\n  }\n}\n\nfunction getMarkItems(id, ele) {\n  let doms = []\n  if (typeof id === 'undefined') {\n    doms = ele.querySelectorAll('mark[data-mark-id]')\n  } else {\n    doms = ele.querySelectorAll(\n      `mark[data-mark-id=${JSON.stringify(id)}]`\n    )\n  }\n  return doms\n}\n\nfunction batchSetMarkAttribute(id, { words, color }, ele) {\n  let doms = getMarkItems(id, ele)\n  for (let i = 0; i < doms.length; i++) {\n    let dom = doms[i]\n    words && dom.setAttribute('data-mark-words', words)\n    color && (dom.style.backgroundColor = rgbHex(color))\n  }\n}\n\nfunction remove(removeId, ele) {\n  let doms = getMarkItems(removeId, ele)\n\n  /* eslint-disable no-use-before-define */\n  for (let i = 0; i < doms.length; i++) {\n    let dom = doms[i]\n    if (dom.parentNode) {\n      let textNode = dom.firstChild\n      dom.parentNode.replaceChild(textNode, dom)\n      prependTextNodeChunks(textNode)\n      appendTextNodeChunks(textNode)\n    }\n  }\n}\n\nfunction getPopover(ele, opt) {\n  let self = this\n  let popover = domUtil.getSingleDOM('div', void 0, document)\n  popover.style.position = 'absolute'\n  popover.style.display = 'none'\n  popover.className = 'mark-highlight-popover'\n  Object.assign(popover, {\n    hide() {\n      this.style.display = 'none'\n    },\n    show(pos, colors) {\n      if (pos) {\n        this.style.top = pos.top + pos.height + 'px'\n        this.style.left = pos.left + pos.width + 'px'\n      }\n      if (colors) {\n        this.innerHTML = colors\n          .map(c => {\n            let className = 'mark-highlight-color'\n            return `<span class=\"${className}\" style=\"background-color: ${c}\"></span>`\n          })\n          .join('')\n      }\n      this.innerHTML += '<textarea placeholder=\"input your idea\" style=\"display: none\"></textarea>'\n      this.style.display = ''\n    },\n    selectColor(color, id) {\n      this._resetActive()\n      let colors = this.querySelectorAll('.mark-highlight-color')\n      for (let i = 0; i < colors.length; i++) {\n        if (rgbHex(colors[i].style.backgroundColor) === rgbHex(color)) {\n          id && colors[i].setAttribute('data-mark-id', id)\n          colors[i].classList.add('mark-highlight-active-color')\n          this.setText('')\n          return\n        }\n      }\n    },\n    setText(text) {\n      let textarea = this.querySelector('textarea')\n      textarea.style.display = ''\n      textarea.value = text\n\n      textarea.focus()\n      textarea.onblur = async () => {\n        let activeItem = popover.getActive()\n        if (!activeItem) {\n          return\n        }\n        const words = textarea.value\n        await self.emit('highlight-change:words', { id: activeItem.id, words })\n        batchSetMarkAttribute(activeItem.id, { words }, ele)\n      }\n    },\n    _resetActive() {\n      let active = this.querySelector('.mark-highlight-active-color')\n      if (active) {\n        active.removeAttribute('data-mark-id')\n        active.classList.remove('mark-highlight-active-color')\n      }\n    },\n    getActive() {\n      let active = this.querySelector('.mark-highlight-active-color')\n      return (\n        active && {\n          color: active.style.backgroundColor,\n          id: active.getAttribute('data-mark-id')\n        }\n      )\n    }\n  })\n  opt.window.document.body.appendChild(popover)\n  popover.addEventListener('click', async evt => {\n    let target = evt.target\n    if (target.classList.contains('mark-highlight-color')) {\n      let color = target.style.backgroundColor\n      if (\n        target.classList.contains('mark-highlight-active-color') &&\n        target.hasAttribute('data-mark-id')\n      ) {\n        let removeId = target.getAttribute('data-mark-id')\n        // Remove\n        await this.emit('highlight-remove', removeId)\n        remove(removeId, ele)\n        popover.hide()\n        target.classList.remove('mark-highlight-active-color')\n      } else {\n        let active = popover.getActive()\n        if (active) {\n          await this.emit('highlight-change:color', { id: active.id, color })\n\n          popover.selectColor(color, active.id)\n\n          batchSetMarkAttribute(active.id, { color }, ele)\n          return\n        }\n\n        let list = selectionUtil.getSelectionTextList(opt.window.getSelection())\n        let containsMarked = list.find(textNode =>\n          isItemNode(textNode.parentNode)\n        )\n        if (containsMarked) {\n          return\n        }\n\n        // slice side effect\n        selectionUtil.getLastRangePos(opt.window)\n\n        list = selectionUtil.getSelectionTextSeqList(opt.window.getSelection())\n\n        let uid = opt.generateUid()\n        target.setAttribute('data-mark-id', uid)\n        let nodeList = list.filter(textNode => ele.contains(textNode))\n\n        const chunks = nodeList.map(node => {\n          let parentNode = node.parentNode\n          let offset = 0\n          for (let i = 0; i < parentNode.childNodes.length; i++) {\n            let childNode = parentNode.childNodes[i]\n            if (childNode === node) {\n              break\n            }\n            if (childNode && 'textContent' in childNode) {\n              offset += childNode.textContent.length\n            }\n          }\n\n          return {\n            offset,\n            length: node.textContent.length,\n            parentSelector: domUtil.getSelector(parentNode, ele)\n          }\n        })\n        if (chunks && chunks.length) {\n          this.highlight.lock = true\n          try {\n            await this.emit('highlight-add', { chunks, id: uid, color })\n            this.highlight.lock = false\n          } catch (e) {\n            this.highlight.lock = false\n            throw e\n          }\n        }\n\n        nodeList.forEach(textNode => {\n          replaceToMark(textNode, { uid, color }, opt)\n        })\n        selectionUtil.removeRanges(window)\n        /* eslint-disable no-use-before-define */\n        resetQueue.clear()\n        popover.selectColor(color, uid)\n      }\n\n    }\n  })\n  return popover\n}\n\nfunction isItemNode(node) {\n  return (\n    node &&\n    node.classList &&\n    node.classList.contains('mark-highlight-item') &&\n    node.tagName &&\n    node.tagName.toLowerCase() === 'mark'\n  )\n}\n\nfunction _fill({ color, words, id, offset, length } = {}, dom, opt) {\n  const { reset, nodes } = selectionUtil.sliceNode(\n    dom,\n    { offset, length },\n    opt.window\n  )\n  // if (reset) {\n  //   resetQueue.add(id, reset)\n  // }\n  if (nodes && nodes[1]) {\n    replaceToMark(nodes[1], { uid: id, color, words }, opt)\n  }\n}\n\nfunction fill({ color, id, words, chunks = [] } = {}, ele = document, opt) {\n  if (!Array.isArray(chunks)) {\n    return\n  }\n  let domList = chunks.map(({ parentSelector }) =>\n    ele.querySelector(parentSelector)\n  )\n  chunks.forEach((chunk, i) => {\n    domList[i] && _fill({ color, id, words, ...chunk }, domList[i], opt)\n  })\n}\n\nasync function mouseUpCore(opt, ele, popover, { target }) {\n  if (this.highlight.lock) {\n    return\n  }\n  // console.log('mouseUpCore')\n  let selection = opt.window.getSelection()\n  if (!selection.isCollapsed) {\n    const markedList = selectionUtil.getSelectionContainsList(\n      node => isItemNode(node) || isItemNode(node.parentNode)\n    )(opt.window.getSelection())\n    // Selected contains marked item\n    if (markedList.length) {\n      return\n    }\n\n    let { reset, pos } = selectionUtil.getLastRangePos(opt.window)\n    if (reset) {\n      resetQueue.add('TEMP', reset)\n    }\n\n    if (pos) {\n      popover.show(pos, opt.highlightColors)\n    } else {\n      popover.hide()\n    }\n  }\n}\n\nfunction mouseDown(opt, ele, popover, { target }) {\n  if (this.highlight.lock) {\n    return\n  }\n\n  if (\n    target.classList.contains('mark-highlight-item') &&\n    target.hasAttribute('data-mark-id')\n  ) {\n    return\n  }\n  if (!popover.contains(target)) {\n    popover.hide()\n    resetQueue.reset('TEMP')\n    // console.log(target)\n  }\n}\n\nasync function click(opt, ele, popover, evt) {\n  if (this.highlight.lock) {\n    return\n  }\n\n  let target = evt.target\n  if (\n    target.classList.contains('mark-highlight-item') &&\n    target.hasAttribute('data-mark-id')\n  ) {\n    let id = target.getAttribute('data-mark-id')\n    let color = target.style.backgroundColor\n    let words = target.getAttribute('data-mark-words')\n\n    let colorList = opt.highlightColors.slice().map(x => rgbHex(x))\n    if (!colorList.includes(rgbHex(color))) {\n      colorList.push(rgbHex(color))\n    }\n    popover.show(domUtil.getPageOffset(target), colorList)\n    popover.selectColor(color, id)\n    words && popover.setText(words)\n  }\n  if (opt.highlight.disableDefaultClick) {\n    // evt.stopPropagation()\n    evt.preventDefault()\n  }\n}\n\nfunction mouseEnter(opt, ele, popover, { target }) {\n  if (\n    target.classList.contains('mark-highlight-item') &&\n    target.hasAttribute('data-mark-id')\n  ) {\n    // let color = target.style.backgroundColor\n    let domList = ele.querySelectorAll(\n      `.mark-highlight-item[data-mark-id=${JSON.stringify(\n        target.getAttribute('data-mark-id')\n      )}]`\n    )\n    Array.from(domList).forEach(dom => {\n      dom.style.filter = 'brightness(85%)'\n      dom.style.webkitFilter = 'brightness(85%)'\n      dom.style.msFilter = 'brightness(85%)'\n      dom.style.mozFilter = 'brightness(85%)'\n    })\n  }\n}\n\nfunction mouseLeave(opt, ele, popover, { target }) {\n  if (\n    target.classList.contains('mark-highlight-item') &&\n    target.hasAttribute('data-mark-id')\n  ) {\n    let domList = ele.querySelectorAll(\n      `[data-mark-id=${JSON.stringify(target.getAttribute('data-mark-id'))}]`\n    )\n\n    Array.from(domList).forEach(dom => {\n      dom.style.filter = ''\n      dom.style.webkitFilter = ''\n      dom.style.msFilter = ''\n      dom.style.mozFilter = ''\n    })\n  }\n}\n\nexport default function highlight(element, options) {\n  if (!window.getSelection) {\n    throw new Error('window.getSelection is not existed')\n  }\n\n  options = {\n    generateUid() {\n      return md5(new Date().getTime() + Math.random() + '')\n    },\n    window: window,\n    highlightColors: ['#fff682', 'pink', '#b2f0ff', '#c57dff'],\n    ...options\n  }\n\n  const document = options.window.document\n  let style = document.createElement('style')\n  style.innerHTML = styleText\n  document.head.appendChild(style)\n\n  function removeStyle() {\n    document.head.removeChild(style)\n  }\n\n  const popover = getPopover.call(this, element, options)\n  const debouncedMouseUp = debounce(mouseUpCore, 100).bind(\n    this,\n    options,\n    element,\n    popover\n  )\n  const debouncedMouseDown = debounce(mouseDown, 100).bind(\n    this,\n    options,\n    element,\n    popover\n  )\n  const onClick = click.bind(this, options, element, popover)\n  const onMouseEnter = mouseEnter.bind(this, options, element, popover)\n  const onMouseLeave = mouseLeave.bind(this, options, element, popover)\n\n  element.__reset && element.__reset()\n  element.__reset = () => {\n    popover.parentNode && popover.parentNode.removeChild(popover)\n    element.removeEventListener('click', onClick)\n    element.removeEventListener('mouseover', onMouseEnter)\n    element.removeEventListener('mouseout', onMouseLeave)\n    element.removeEventListener('mouseup', debouncedMouseUp)\n    element.removeEventListener('mousedown', debouncedMouseDown)\n    removeStyle()\n  }\n\n  element.addEventListener('click', onClick)\n  element.addEventListener('mouseover', onMouseEnter)\n  element.addEventListener('mouseout', onMouseLeave)\n  element.addEventListener('mouseup', debouncedMouseUp)\n  element.addEventListener('mousedown', debouncedMouseDown)\n\n  this.highlight = {\n    fill: function(data, ele = element) {\n      if (Array.isArray(data)) {\n        return data.forEach(item => fill(item, ele, options))\n      }\n      fill(data, ele, options)\n    },\n    remove: function(id, ele = element) {\n      let active = popover.getActive()\n      if (active && active.id === id) {\n        popover.hide()\n      }\n      return remove(id, ele)\n    },\n    exit() {\n      element.__reset && element.__reset()\n    }\n  }\n}\n","/**\n * @file index\n * @author Cuttle Cong\n * @date 2018/5/1\n * @description\n */\n\n\n\nexport default function (element) {\n  const ctx = this\n\n}\n","/**\n * @file index\n * @author Cuttle Cong\n * @date 2018/4/30\n * @description\n */\nimport highlight from './plugins/highlight/index'\nimport badge from './plugins/badge/index'\nimport AwaitEventEmitter from 'await-event-emitter'\n\nconst isBrowser = typeof document !== 'undefined'\n\nconst plugins = {\n  highlight: highlight,\n  badge: badge\n}\n\nfunction run(func, message, ...args) {\n  try {\n    func.apply(this, args)\n  } catch (e) {\n    console.error(message, e.toString())\n  }\n}\n\nfunction registerCommonMethod(ctx, methodName, plugins = []) {\n  ctx[methodName] = function () {\n    plugins.forEach(pluginName => {\n      if (ctx[pluginName] && ctx[pluginName][methodName]) {\n        ctx[pluginName][methodName].apply(ctx[pluginName], arguments)\n      }\n    })\n  }\n}\n\nexport default function mark(element, options = {}) {\n  if (!isBrowser) {\n    throw new Error('mark should be used in browser environment.')\n  }\n  options = {\n    enablePlugins: ['highlight', 'badge'],\n    ...options,\n    highlight: {\n      disableDefaultClick: false,\n      ...options.highlight\n    }\n  }\n  const { enablePlugins, ...restOptions } = options\n\n  const ctx = new AwaitEventEmitter()\n  ctx.opt = options\n\n  // TODO\n  ctx.addButton = function({ title, icon, action } = {}) {}\n\n  enablePlugins.forEach(plugin => {\n    if (plugins[plugin]) {\n      run.call(ctx, highlight, plugin, element, restOptions)\n    }\n  })\n\n  registerCommonMethod(ctx, 'exit', enablePlugins)\n  registerCommonMethod(ctx, 'remove', enablePlugins)\n  // registerCommonMethod(ctx, 'fill', enablePlugins)\n\n  return ctx\n}\n"],"names":["isText","node","nodeType","document","TEXT_NODE","createElem","tagName","createElement","doms","Map","getSingleDOM","id","Math","random","has","get","ele","set","getPageOffset","el","getBoundingClientRect","width","height","left","window","scrollX","top","scrollY","getTextNodeSize","Range","range","createRange","selectNodeContents","walkDOM","func","rlt","firstChild","nextSibling","walk","getSelector","root","Node","ELEMENT_NODE","Error","hasAttribute","getAttribute","children","Array","from","parentNode","index","hasBrother","forEach","x","i","selector","localName","ps","makeReset","fn","wrap","__called","sliceNode","offset","length","sumOffset","relativeOffset","childNodes","child","textContent","text","pNode","nodes","slice","map","createTextNode","head","replaceChild","resetNodes","reset","remove","insertBefore","getLastRangePos","selection","getSelection","getRangeAt","rangeCount","pos","startContainer","endContainer","startParentContainer","parentElement","endParentContainer","commonAncestorContainer","startWholeText","startOffset","endWholeText","endOffset","data","setStart","setEnd","removeRanges","removeAllRanges","getSelectionContainsList","cond","isCollapsed","list","getTexts","isPointInRange","push","getTextList","includes","toLowerCase","getSelectionTextList","isEmpty","trim","getSelectionTextSeqList","textList","newList","shift","previousSibling","filter","opt","popover","target","highlight","lock","selectionUtil","isItemNode","markedList","add","show","highlightColors","hide","mouseUpCore","evt","classList","contains","style","backgroundColor","rgbHex","colorList","color","domUtil","selectColor","setText","words","disableDefaultClick","preventDefault","click","str","_rgbHex","e","replaceToMark","textNode","uid","mark","className","setAttribute","appendChild","MapQueue","mapQueue","val","clear","exec","keys","key","splice","Object","resetQueue","prependTextNodeChunks","prev","tmpPrev","appendTextNodeChunks","next","tmpNext","getMarkItems","querySelectorAll","JSON","stringify","batchSetMarkAttribute","dom","removeId","getPopover","self","position","display","assign","colors","innerHTML","c","join","_resetActive","textarea","querySelector","value","focus","onblur","getActive","activeItem","emit","active","removeAttribute","body","addEventListener","find","containsMarked","generateUid","nodeList","childNode","chunks","_fill","fill","isArray","domList","parentSelector","chunk","mouseDown","mouseEnter","webkitFilter","msFilter","mozFilter","mouseLeave","element","options","md5","Date","getTime","styleText","removeStyle","removeChild","call","debouncedMouseUp","debounce","bind","debouncedMouseDown","onClick","onMouseEnter","onMouseLeave","__reset","removeEventListener","item","isBrowser","plugins","badge","run","message","args","apply","error","toString","registerCommonMethod","ctx","methodName","pluginName","enablePlugins","restOptions","AwaitEventEmitter","addButton","title","icon","action","plugin"],"mappings":"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"}